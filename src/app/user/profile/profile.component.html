<div class="profile-page">
  
  <div class="profile-header text-white">
    <div class="container py-4">
      <div class="d-flex align-items-end gap-4">
        <div class="avatar-container">
          <img [src]="user.profileUrl" alt="User" class="profile-avatar shadow-lg">
        </div>
        <div class="mb-3">
          <h2 class="mb-0 fw-bold">{{ user.name }}</h2>
          <p class="text-secondary small mb-0"><i class="bi bi-envelope-fill text-primary me-1"></i> {{ user.email }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4 pb-5">
    <div class="row g-4">
      
      <div class="col-md-4 col-lg-3">
        <div class="card glass-card border-0 shadow-lg">
          <div class="card-body p-3">
            <div class="nav flex-column nav-pills gap-1">
              
              <button class="nav-link custom-nav-link d-flex align-items-center gap-3" 
                      [class.active]="activeTab === 'basic'" 
                      (click)="setActiveTab('basic')">
                <i class="bi bi-person-vcard fs-5 text-primary"></i> Basic Info
              </button>
              
              <button class="nav-link custom-nav-link d-flex align-items-center gap-3" 
                      [class.active]="activeTab === 'account'" 
                      (click)="setActiveTab('account')">
                <i class="bi bi-shield-lock fs-5 text-danger"></i> Account
              </button>

            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8 col-lg-9">
        <div class="card glass-card border-0 shadow-lg">
          
          <div *ngIf="activeTab === 'basic'">
            <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 pt-4 pb-3 px-4">
              <h5 class="fw-bold text-white mb-0">Basic Info</h5>
            </div>
            
            <div class="card-body p-4">

              <ng-container *ngFor="let field of [
                { key: 'name', label: 'Name', type: 'text', placeholder: 'Add Name' },
                { key: 'phone', label: 'Phone', type: 'text', placeholder: 'Add Phone Number' },
                { key: 'location', label: 'Location', type: 'text', placeholder: 'Add Location' },
                { key: 'dob', label: 'DOB', type: 'date', placeholder: 'Add DOB' },
                { key: 'occupation', label: 'Occupation', type: 'text', placeholder: 'Add Occupation' }
              ]">
                <div class="info-row">
                  <div class="label text-secondary small text-uppercase tracking-wide">{{ field.label }}</div>
                  
                  <ng-container *ngIf="editingField !== field.key">
                    <div class="value text-white fw-medium">{{ $any(user)[field.key] || field.placeholder }}</div>
                    <div class="action">
                      <button class="btn-icon" (click)="startEdit($any(field.key))"><i class="bi bi-pencil"></i></button>
                    </div>
                  </ng-container>

                  <div *ngIf="editingField === field.key" class="flex-grow-1">
                    <input [type]="field.type" class="form-control custom-profile-input mb-3" [(ngModel)]="tempValue">
                    <div class="d-flex gap-2">
                      <button class="btn btn-sm btn-primary primary-btn px-4" (click)="saveEdit($any(field.key))" [disabled]="isUpdating">
                        <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                      </button>
                      <button class="btn btn-sm btn-outline-secondary px-3" (click)="cancelEdit()">Cancel</button>
                    </div>
                  </div>
                </div>
              </ng-container>

              <div class="info-row">
                <div class="label text-secondary small text-uppercase tracking-wide">Gender</div>
                <ng-container *ngIf="editingField !== 'gender'">
                  <div class="value text-white fw-medium">{{ user.gender || 'Add Gender' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('gender')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>
                <div *ngIf="editingField === 'gender'" class="flex-grow-1">
                  <select class="form-select custom-profile-input mb-3" [(ngModel)]="tempValue">
                    <option value="" disabled>Select Gender</option>
                    <option value="Male" class="bg-dark text-white">Male</option>
                    <option value="Female" class="bg-dark text-white">Female</option>
                    <option value="Other" class="bg-dark text-white">Other</option>
                  </select>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary primary-btn px-4" (click)="saveEdit('gender')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary px-3" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row border-bottom-0 pb-0">
                <div class="label text-secondary small text-uppercase tracking-wide">Summary</div>
                <ng-container *ngIf="editingField !== 'bio'">
                  <div class="value text-white text-truncate-2" style="line-height: 1.6;">
                    {{ user.bio || 'Write something about yourself...' }}
                  </div>
                  <div class="action align-self-start">
                    <button class="btn-icon" (click)="startEdit('bio')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>
                <div *ngIf="editingField === 'bio'" class="flex-grow-1">
                  <textarea class="form-control custom-profile-input mb-3" rows="3" [(ngModel)]="tempValue"></textarea>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary primary-btn px-4" (click)="saveEdit('bio')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary px-3" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div *ngIf="activeTab === 'account'">
            <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 pt-4 pb-3 px-4">
              <h5 class="fw-bold text-white mb-0">Account Settings</h5>
            </div>
            
            <div class="card-body p-4">
              <div class="info-row border-bottom-0">
                 <div class="label text-secondary small text-uppercase tracking-wide">Email</div>
                 <div class="value text-white fw-medium">{{ user.email }}</div>
                 <div class="action">
                   <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-2 py-1">Verified</span>
                 </div>
              </div>

              <div class="info-row mt-3 border-bottom-0">
                <div class="label text-secondary small text-uppercase tracking-wide">Password</div>
                <div class="value text-white">••••••••••••••</div>
                <div class="action">
                  <button class="btn btn-outline-light btn-sm rounded-pill px-3" (click)="openPasswordModal()">
                    Change
                  </button>
                </div>
              </div>

              <div class="mt-5 pt-4 border-top border-danger border-opacity-25">
                <div class="d-flex justify-content-between align-items-center p-4 rounded-4" style="background: rgba(220, 53, 69, 0.05); border: 1px solid rgba(220, 53, 69, 0.2);">
                  <div>
                    <strong class="text-danger d-block mb-1">Delete Account</strong>
                    <small class="text-secondary">Once deleted, there is no going back. All data will be lost.</small>
                  </div>
                  <button class="btn btn-danger fw-bold" (click)="openDeleteModal()">Delete</button>
                </div>
              </div>

            </div>
          </div>

        </div>
      </div>

    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showPasswordModal">
    <div class="custom-modal glass-card p-1 shadow-lg border border-secondary border-opacity-25">
      <div class="card-body p-4 p-sm-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="fw-bold text-white mb-0">Change Password</h4>
          <button type="button" class="btn-close btn-close-white" (click)="closePasswordModal()"></button>
        </div>
        
        <div class="mb-3">
          <label class="form-label text-secondary small">Old Password</label>
          <input type="password" class="form-control custom-profile-input" [(ngModel)]="passwordData.oldPassword">
        </div>

        <div class="mb-4">
          <label class="form-label text-secondary small">New Password</label>
          <input type="password" class="form-control custom-profile-input" [(ngModel)]="passwordData.newPassword">
        </div>

        <div class="d-grid gap-2">
          <button class="btn btn-primary primary-btn fw-bold py-2" (click)="onChangePassword()" [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span> Update Password
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showDeleteModal">
    <div class="custom-modal glass-card p-1 shadow-lg" style="border: 1px solid rgba(220, 53, 69, 0.3);">
      <div class="card-body p-4 p-sm-5 text-center">
        <div class="mb-3">
          <div class="icon-circle mx-auto d-flex align-items-center justify-content-center rounded-circle mb-3" 
               style="width: 70px; height: 70px; background-color: rgba(220, 53, 69, 0.15); color: #ea868f;">
            <i class="bi bi-exclamation-triangle-fill" style="font-size: 2rem;"></i>
          </div>
        </div>
        <h4 class="fw-bold text-white">Delete Account?</h4>
        <p class="text-secondary mb-4 small">
          This action cannot be undone. All your posts, saved items, and personal data will be permanently erased.
        </p>

        <div class="d-flex flex-column gap-2">
          <button class="btn btn-danger fw-bold py-2" (click)="onDeleteAccount()" [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span> Yes, Delete Forever
          </button>
          <button class="btn btn-outline-secondary py-2 border-0" (click)="closeDeleteModal()">Cancel, Keep Account</button>
        </div>
      </div>
    </div>
  </div>

</div>