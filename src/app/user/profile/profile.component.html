<div class="profile-page">
  
  <div class="profile-header text-white">
    <div class="container py-4">
      <div class="d-flex align-items-end gap-4">
        <div class="avatar-container" style="border: 3px solid white; border-radius: 10px;">
          <img [src]="user.profileUrl" alt="User" class="profile-avatar shadow-lg">
        </div>
        <div class="mb-2">
          <h2 class="mb-0">{{ user.name }}</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <div class="row g-4">
      
      <div class="col-md-3">
        <div class="card sidebar-card border-0 shadow-sm">
          <div class="card-body p-2">
            <div class="nav flex-column nav-pills">
              
              <button class="nav-link d-flex align-items-center gap-3" 
                      [class.active]="activeTab === 'basic'" 
                      (click)="setActiveTab('basic')">
                <i class="bi bi-person-vcard fs-5"></i> Basic Info
              </button>
              
              <button class="nav-link d-flex align-items-center gap-3" 
                      [class.active]="activeTab === 'account'" 
                      (click)="setActiveTab('account')">
                <i class="bi bi-shield-lock fs-5"></i> Account
              </button>

            </div>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="card content-card border-0 shadow-sm">
          
          <div *ngIf="activeTab === 'basic'">
            <div class="card-header bg-transparent border-bottom border-secondary pt-4 pb-3">
              <h5 class="fw-bold text-white mb-0">Basic Info</h5>
            </div>
            
            <div class="card-body p-4">

              <div class="info-row">
                <div class="label grey-color">Name</div>

                <ng-container *ngIf="editingField !== 'name'">
                  <div class="value text-white">{{ user.name }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('name')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'name'" class="flex-grow-1">
                  <input type="text" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('name')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">Email</div>
                <div class="value text-white">{{ user.email }}</div>
                </div>

              <div class="info-row">
                <div class="label grey-color">Phone</div>

                <ng-container *ngIf="editingField !== 'phone'">
                  <div class="value text-white">{{ user.phone || 'Add Phone Number' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('phone')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'phone'" class="flex-grow-1">
                  <input type="text" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('phone')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">Gender</div>

                <ng-container *ngIf="editingField !== 'gender'">
                  <div class="value text-white">{{ user.gender || 'Add Gender' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('gender')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'gender'" class="flex-grow-1">
                  <select class="form-select bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('gender')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">Location</div>

                <ng-container *ngIf="editingField !== 'location'">
                  <div class="value text-white">{{ user.location || 'Add Location' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('location')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'location'" class="flex-grow-1">
                  <input type="text" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('location')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">DOB</div>

                <ng-container *ngIf="editingField !== 'dob'">
                  <div class="value text-white">{{ user.dob || 'Add dob' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('dob')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'dob'" class="flex-grow-1">
                  <input type="date" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('dob')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">Occupation</div>

                <ng-container *ngIf="editingField !== 'occupation'">
                  <div class="value text-white">{{ user.occupation || 'Add Occupation' }}</div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('occupation')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'occupation'" class="flex-grow-1">
                  <input type="text" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('occupation')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="info-row">
                <div class="label grey-color">Summary</div>

                <ng-container *ngIf="editingField !== 'bio'">
                  <div class="value text-white text-truncate-2">
                    {{ user.bio || 'Write something about yourself...' }}
                  </div>
                  <div class="action">
                    <button class="btn-icon" (click)="startEdit('bio')"><i class="bi bi-pencil"></i></button>
                  </div>
                </ng-container>

                <div *ngIf="editingField === 'bio'" class="flex-grow-1">
                  <input type="text" class="form-control bg-dark text-white border-secondary mb-2" [(ngModel)]="tempValue">
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-primary" (click)="saveEdit('bio')" [disabled]="isUpdating">
                      <span *ngIf="isUpdating" class="spinner-border spinner-border-sm me-1"></span> Update
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="cancelEdit()">Cancel</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="activeTab === 'account'">
            <div class="card-header bg-transparent border-bottom border-secondary pt-4 pb-3">
              <h5 class="fw-bold text-white mb-0">Account Settings</h5>
            </div>
            
            <div class="card-body p-4">
              <div class="info-row">
                 <div class="label grey-color">Email</div>
                 <div class="value text-white">{{ user.email }}</div>
              </div>

              <div class="info-row mt-3">
                <div class="label grey-color">Password</div>
                <div class="value text-white">••••••••••••••</div>
                <div class="action">
                  <button class="btn btn-outline-primary btn-sm rounded-pill px-3" 
                          (click)="openPasswordModal()">
                    Change Password
                  </button>
                </div>
              </div>

              <div class="mt-5 pt-4 border-top border-danger border-opacity-25">
                <div class="d-flex justify-content-between align-items-center p-3 rounded" style="background: rgba(220, 53, 69, 0.1);">
                  <div>
                    <strong class="text-danger d-block">Delete Account</strong>
                    <small class="text-white-50">Once deleted, there is no going back.</small>
                  </div>
                  <button class="btn btn-danger btn-sm fw-bold" (click)="openDeleteModal()">Delete Account</button>
                </div>
              </div>

            </div>
          </div>

          <div class="modal-backdrop" *ngIf="showPasswordModal">
            <div class="custom-modal card bg-dark text-white border-secondary shadow-lg">
              <div class="card-body p-4">
                <h4 class="fw-bold mb-4">Change Password</h4>
                
                <div class="mb-3">
                  <label class="form-label text-muted small">Old Password</label>
                  <input type="password" class="form-control bg-black text-white border-secondary" 
                         [(ngModel)]="passwordData.oldPassword">
                </div>
        
                <div class="mb-4">
                  <label class="form-label text-muted small">New Password</label>
                  <input type="password" class="form-control bg-black text-white border-secondary" 
                         [(ngModel)]="passwordData.newPassword">
                </div>
        
                <div class="d-flex justify-content-end gap-2">
                  <button class="btn btn-outline-secondary" (click)="closePasswordModal()">Cancel</button>
                  <button class="btn btn-primary" (click)="onChangePassword()" [disabled]="isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span> Change
                  </button>
                </div>
              </div>
            </div>
          </div>
        
          <div class="modal-backdrop" *ngIf="showDeleteModal">
            <div class="custom-modal card bg-dark text-white border-danger shadow-lg">
              <div class="card-body p-4 text-center">
                <div class="mb-3 text-danger">
                  <i class="bi bi-exclamation-triangle-fill fs-1"></i>
                </div>
                <h4 class="fw-bold">Are you sure?</h4>
                <p class="text-white-50 mb-4">
                  This action cannot be undone. All your data, posts, and history will be permanently erased.
                </p>
        
                <div class="d-flex justify-content-center gap-3">
                  <button class="btn btn-secondary px-4" (click)="closeDeleteModal()">Cancel</button>
                  <button class="btn btn-danger px-4 fw-bold" (click)="onDeleteAccount()" [disabled]="isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span> Delete Forever
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>