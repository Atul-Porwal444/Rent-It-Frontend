<div class="modal-overlay">
  <div class="modal-card shadow-lg">
    
    <div class="modal-header d-flex justify-content-between align-items-center px-3 py-2 border-bottom border-secondary">
      <h5 class="text-white fw-bold mb-0" style="font-size: 1rem;">
        <i class="bi" [class.bi-house-add-fill]="adType === 'room'" [class.bi-people-fill]="adType === 'roommate'"></i>
        Post {{ adType === 'room' ? 'Room' : 'Roommate' }} Ad
      </h5>
      <button class="btn-close btn-close-white btn-sm" (click)="close.emit()"></button>
    </div>

    <div class="modal-body p-3 text-white">
      <form (ngSubmit)="onSubmit()" #adForm="ngForm" autocomplete="off">

        <div class="mb-3">
          <label class="form-label grey-color fw-bold" style="font-size: 0.75rem;">Upload Photos (Max 5)</label>
          <div class="d-flex gap-2 overflow-auto py-1">
            <label class="image-upload-box d-flex flex-column align-items-center justify-content-center border border-secondary border-dashed rounded text-secondary" style="min-width: 80px; height: 80px; cursor: pointer;">
              <i class="bi bi-camera fs-4"></i>
              <span style="font-size: 0.7rem;">Add</span>
              <input type="file" multiple accept="image/png, image/jpeg" hidden (change)="onFileSelected($event)">
            </label>

            <div *ngFor="let img of imagePreviews; let i = index" class="position-relative">
              <img [src]="img" class="rounded object-fit-cover" style="width: 80px; height: 80px; border: 1px solid #444;">
              <button type="button" class="btn btn-sm btn-danger rounded-circle position-absolute top-0 end-0 m-1 p-0 px-1" style="font-size: 0.6rem; line-height: 1;" (click)="removeImage(i)">×</button>
            </div>
          </div>
          <small class="text-danger" style="font-size: 0.7rem;" *ngIf="selectedImages.length >= 5">Max limit reached</small>
        </div>

        <div class="row g-2 mb-2">

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">State</label>
            <input type="text" class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.state" name="state" required 
                   placeholder="Select State..." list="stateList">
            <datalist id="stateList">
              <option *ngFor="let state of indianStates" [value]="state"></option>
            </datalist>
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">City</label>
            <input type="text" class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.city" name="city" required 
                   placeholder="Type to search..." list="cityList" maxlength="30">
            <datalist id="cityList">
              <option *ngFor="let city of indianCities" [value]="city"></option>
            </datalist>
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Location / Area</label>
            <input type="text" class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.location" name="loc" required 
                   placeholder="e.g. Vijay Nagar" maxlength="40">
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Pincode</label>
            <input type="number" class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.pincode" name="pincode" required 
                   placeholder="e.g. 452010" 
                   min="100000" max="999999" 
                   (keydown)="preventNegative($event)">
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">BHK Type</label>
            <select class="form-select form-select-sm bg-dark text-white border-secondary" [(ngModel)]="formData.bhkType" name="bhk">
              <option value="1RK">1 RK</option>
              <option value="1BHK">1 BHK</option>
              <option value="2BHK">2 BHK</option>
              <option value="3BHK">3 BHK</option>
            </select>
          </div>
          
          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Floor No.</label>
            <input type="number" min="0" max="200"
                   class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.floorNumber" name="floor" 
                   (keydown)="preventNegative($event)" required>
          </div>
          
          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Rent (₹)</label>
            <input type="number" min="0" max="1000000"
                   class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.rentAmount" name="rent" 
                   (keydown)="preventNegative($event)" required>
            
            <small class="text-danger d-block" *ngIf="formData.rentAmount > 1000000">
              Rent amount should be less than 1,000,000
            </small>
          </div>

          <div class="col-md-6" *ngIf="adType === 'room'">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Security Deposit (₹)</label>
            <input type="number" min="0" max="1000000"
                   class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.securityDeposit" name="deposit"
                   (keydown)="preventNegative($event)" required>
            
            <small class="text-danger d-block" *ngIf="formData.securityDeposit > 1000000">
              Deposit amount should be less than 1,000,000
            </small>
          </div>
        </div>

        <div *ngIf="adType === 'roommate'" class="row g-2 mb-2">
          
          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Looking For (Gender)</label>
            <select class="form-select form-select-sm bg-dark text-white border-secondary" [(ngModel)]="formData.lookingForGender" name="gender">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Dietary Preference</label>
            <select class="form-select form-select-sm bg-dark text-white border-secondary" [(ngModel)]="formData.dietaryPreference" name="diet">
              <option value="No Preference">No Preference</option>
              <option value="Vegetarian">Vegetarian</option>
              <option value="Non-Vegetarian">Non-Vegetarian</option>
              <option value="Vegan">Vegan</option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Religion Preference</label>
            <select class="form-select form-select-sm bg-dark text-white border-secondary" [(ngModel)]="formData.religionPreference" name="religion">
              <option value="No Preference">No Preference</option>
              <option value="Hindu">Hindu</option>
              <option value="Muslim">Muslim</option>
              <option value="Sikh">Sikh</option>
              <option value="Christian">Christian</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="col-md-3 col-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Current Roommates</label>
            <input type="number" min="0" max="10"
                   class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.currentRoommates" name="curr"
                   (keydown)="preventNegative($event)" required>
          </div>

          <div class="col-md-3 col-6">
            <label class="form-label grey-color" style="font-size: 0.75rem;">Needed Roommates</label>
            <input type="number" min="1" max="10"
                   class="form-control form-control-sm bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.neededRoommates" name="needed"
                   (keydown)="preventNegative($event)" required>
          </div>

        </div>

        <div class="mb-3">
          <label class="form-label grey-color fw-bold" style="font-size: 0.75rem;">Amenities</label>
          <div class="d-flex flex-wrap gap-3 mt-1">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.isFurnished" name="furn">
              <label class="form-check-label small" style="font-size: 0.75rem;">Furnished</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.hasParking" name="park">
              <label class="form-check-label small" style="font-size: 0.75rem;">Parking</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.waterSupply24x7" name="water">
              <label class="form-check-label small" style="font-size: 0.75rem;">24x7 Water</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.electricityBackup" name="elec">
              <label class="form-check-label small" style="font-size: 0.75rem;">Power Backup</label>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label grey-color" style="font-size: 0.75rem;">Description</label>
          <textarea 
            class="form-control form-control-sm bg-dark text-white border-secondary" 
            rows="3" 
            [(ngModel)]="formData.description" 
            name="desc" 
            placeholder="More details..." 
            [maxlength]="DESC_MAX_LENGTH">
          </textarea>
          
          <div class="char-counter grey-color" style="font-size: 0.7rem;">
            {{ formData.description?.length || 0 }} / {{ DESC_MAX_LENGTH }}
          </div>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-sm fw-bold py-2" [disabled]="adForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            Post {{ adType === 'room' ? 'Room' : 'Roommate Request' }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>