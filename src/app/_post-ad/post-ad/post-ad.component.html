<div class="modal-overlay">
  <div class="modal-card shadow-lg">
    
    <div class="modal-header d-flex justify-content-between align-items-center p-3 border-bottom border-secondary">
      <h4 class="text-white fw-bold mb-0">
        <i class="bi" [class.bi-house-add-fill]="adType === 'room'" [class.bi-people-fill]="adType === 'roommate'"></i>
        Post {{ adType === 'room' ? 'Room' : 'Roommate' }} Ad
      </h4>
      <button class="btn-close btn-close-white" (click)="close.emit()"></button>
    </div>

    <div class="modal-body p-4 text-white">
      <form (ngSubmit)="onSubmit()" #adForm="ngForm">

        <div class="mb-4">
          <label class="form-label grey-color fw-bold small">Upload Photos (Max 5, .png/.jpg only)</label>
          <div class="d-flex gap-2 overflow-auto py-2">
            <label class="image-upload-box d-flex flex-column align-items-center justify-content-center border border-secondary border-dashed rounded text-secondary" style="min-width: 100px; height: 100px; cursor: pointer;">
              <i class="bi bi-camera fs-3"></i>
              <span class="small">Add</span>
              <input type="file" multiple accept="image/png, image/jpeg" hidden (change)="onFileSelected($event)">
            </label>

            <div *ngFor="let img of imagePreviews; let i = index" class="position-relative">
              <img [src]="img" class="rounded object-fit-cover" style="width: 100px; height: 100px; border: 1px solid #444;">
              <button type="button" class="btn btn-sm btn-danger rounded-circle position-absolute top-0 end-0 m-1 p-0 px-1" (click)="removeImage(i)">×</button>
            </div>
          </div>
          <small class="text-danger" *ngIf="selectedImages.length >= 5">Max limit reached (5/5)</small>
        </div>

        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label grey-color small">City</label>
            <input type="text" class="form-control bg-dark text-white border-secondary" [(ngModel)]="formData.city" name="city" required placeholder="e.g. Indore">
          </div>
          <div class="col-md-6">
            <label class="form-label grey-color small">Location / Area</label>
            <input type="text" class="form-control bg-dark text-white border-secondary" [(ngModel)]="formData.location" name="loc" required placeholder="e.g. Vijay Nagar">
          </div>
          <div class="col-md-6" *ngIf="adType === 'room'">
            <label class="form-label grey-color small">BHK Type</label>
            <select class="form-select bg-dark text-white border-secondary" [(ngModel)]="formData.bhkType" name="bhk">
              <option value="1RK">1 RK</option>
              <option value="1BHK">1 BHK</option>
              <option value="2BHK">2 BHK</option>
              <option value="3BHK">3 BHK</option>
            </select>
          </div>
          
          <div class="col-md-6">
            <label class="form-label grey-color small">Floor Number</label>
            <input type="number" min="0" 
                   class="form-control bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.floorNumber" name="floor" 
                   (keydown)="preventNegative($event)" required>
          </div>
          
          <div class="col-md-6">
            <label class="form-label grey-color small">Rent Amount (₹)</label>
            <input type="number" min="0" 
                   class="form-control bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.rentAmount" name="rent" 
                   (keydown)="preventNegative($event)" required>
          </div>
        </div>

        <div *ngIf="adType === 'room'" class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label grey-color small">Security Deposit (₹)</label>
            <input type="number" min="0" 
                   class="form-control bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.securityDeposit" name="deposit"
                   (keydown)="preventNegative($event)" required>
          </div>
        </div>

        <div *ngIf="adType === 'roommate'" class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label grey-color small">Looking For (Gender)</label>
            <select class="form-select bg-dark text-white border-secondary" [(ngModel)]="formData.lookingForGender" name="gender">
              <option value="Any">Any</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label grey-color small">Current Roommates</label>
            <input type="number" min="0" 
                   class="form-control bg-dark text-white border-secondary" 
                   [(ngModel)]="formData.currentRoommates" name="curr"
                   (keydown)="preventNegative($event)">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label grey-color small fw-bold">Amenities & Features</label>
          <div class="d-flex flex-wrap gap-3 mt-1">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.isFurnished" name="furn">
              <label class="form-check-label small">Furnished</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.hasParking" name="park">
              <label class="form-check-label small">Parking</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.waterSupply24x7" name="water">
              <label class="form-check-label small">24x7 Water</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" [(ngModel)]="formData.electricityBackup" name="elec">
              <label class="form-check-label small">Power Backup</label>
            </div>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label grey-color small">Description</label>
          <textarea 
            class="form-control bg-dark text-white border-secondary" 
            rows="3" 
            [(ngModel)]="formData.description" 
            name="desc" 
            placeholder="More details..." 
            [maxlength]="DESC_MAX_LENGTH">
          </textarea>
          
          <div class="char-counter grey-color">
            {{ formData.description?.length || 0 }} / {{ DESC_MAX_LENGTH }}
          </div>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg fw-bold" [disabled]="adForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            Post {{ adType === 'room' ? 'Room' : 'Roommate Request' }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>